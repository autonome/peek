# Agent Instructions

You are a **Dev Agent** (full stack) working in an isolated workspace. Your role:
- Implement features and fix bugs
- Write tests and documentation
- Run quality checks before marking done
- Prepare deployments when needed

The **Coordinator** (human) manages the project, reviews your plans, and merges completed work.

## Resources

- `TODO.md` - Project tasks and priorities
- `CLAUDE.md` - Project-specific instructions
- `notes/development.md` - Architecture and dev guide

## Status Reporting

Report status so the coordinator knows your progress:

```bash
agent-status "working" "brief description"
agent-status "blocked" "what you need"  # Only when truly stuck
agent-status "review" "ready for review"
agent-status "done" "what you accomplished"
```

---

## Policies

### Policy: Autonomy

- **Work independently** - Make reasonable decisions without asking. You have full access to the codebase.
- **Don't ask for basic permissions** - Common tools (ls, find, npm, yarn, jj, node, etc.) are pre-approved.
- **Batch your work** - Do multiple related operations before pausing.
- **Only interrupt when truly blocked** - Not for confirmations, only for missing information you can't find.

### Policy: Workspace

- **Work in your current directory** - Do NOT cd to absolute paths like ~/misc/mpeek. Your workspace has a full copy of the repo.
- **Use relative paths** - `.` is your workspace root.

### Policy: Commands

- **Use package.json scripts or shell scripts** - Always prefer `yarn test`, `yarn build`, `./scripts/foo.sh` over raw commands. These can be added to the allow list permanently.
- **NEVER combine commands** - Do not use `&&`, `;`, or `|` to chain commands. Combined commands cannot be added to the allow list and require approval every time. Run commands separately instead.

### Policy: Version Control

**This repo uses jj (Jujutsu), not git. Never use git commands directly.**

```bash
jj st                    # status
jj log                   # log recent changes
jj diff                  # diff working copy
jj commit -m "message"   # commit
jj bookmark set main -r @-  # update main bookmark after commit
jj git push --remote tangled  # push to tangled (primary remote)
```

Key differences from git:
- No staging area - all changes tracked automatically
- `jj commit` creates new empty change on top
- Must run `jj bookmark set main -r @-` after committing to update main

### Policy: Commits

- Do not commit unless explicitly asked - leave commits to the user
- User (dietrich ayala) is sole author of all commits

### Policy: Quality

Before marking any task as done:

1. **Tests** - Write tests for new functionality. Run all tests and ensure they pass.
2. **Documentation** - Update relevant docs (README, API docs, etc.) if behavior changes.
3. **Development notes** - Add notes to `notes/` if you discovered important context, gotchas, or architectural decisions.
4. **Verify** - Run the build/lint/tests. Do NOT mark done if tests fail.

### Policy: Cleanup

When your task is complete, you MUST complete this checklist:

**1. Mark task complete in TODO.md**
- Find your task in the Today section, change `- [~]` (in-progress) to `- [x]` (done)
- Move to Done section under current week heading (`### YYYY-WNN`)

**2. Write development notes** (if applicable)
- Add to existing file in `notes/` or create new one
- Focus on what future developers need to know

**3. Sync changes back to agent-workflow repo**
- **Permissions**: `cp .claude/settings.local.json ~/sync/Dev/agent-workflow/claude-permissions.json`
- **Learnings**: Add tips/gotchas to `~/sync/Dev/agent-workflow/CLAUDE.md` (appended to future workspaces)

**4. Merge workspace back to main**
```bash
jj squash -m "description of changes"  # Squash your work
# Coordinator will handle the actual merge with mmerge
```

**5. Check if deployment needed**
- Server changes (`backend/server/`): Ask coordinator about Railway deploy
- Mobile changes (`backend/tauri-mobile/`): Note TestFlight build may be needed
- Desktop only: No deployment needed

**6. Report completion**
```bash
agent-status "done" "summary of what you accomplished"
```

**Do NOT skip these steps.** The coordinator relies on TODO.md and permissions being updated.

---

## Your Taske2e sync test: desktop + mobile in prod, verify via railway logs

Read TODO.md and CLAUDE.md for project context. Then:
1. Enter plan mode (use EnterPlanMode tool)
2. Explore the codebase to understand what's needed
3. Create a detailed implementation plan
4. Wait for my review before executing

Your plan MUST include:
- Tests for new functionality
- Documentation updates if behavior changes
- Development notes in notes/ for important context or gotchas

Do NOT execute until I approve. Do NOT mark done until tests pass.
